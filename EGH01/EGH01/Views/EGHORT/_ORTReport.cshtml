@using EGH01.Models.EGHORT;
@using EGH01DB;
@using EGH01DB.Blurs;
@using EGH01.Core;
@model EGH01DB.ORTContext
@{
    ORTContextView context = (ORTContextView)Model.GetViewContext(ORTContextView.VIEWNAME);
    if (context == null) { Model.SaveViewContext(ORTContextView.VIEWNAME,  context = new ORTContextView());}
        
     Menu head = new Menu(
                          new Menu.MenuItem("Сохранить",   "Report.Save", true),
                          new Menu.MenuItem("Отказаться",  "Report.Cancel", true)
                         );
 
   ORTContext.ECORehabilitation ecorehabilitation =   context.ecorehabilitation;


}


@if (ecorehabilitation != null) 
{
       
 string s = string.Format("{0}-Р-{1}", ecorehabilitation.id, ecorehabilitation.date.ToString("yyy-MM-dd"));
 using (Html.BeginForm("ClassificationEvalution", "EGHGEA"))
 {

    <div class="box">
        <div class="boxdata">
            <fieldset>
                <legend> Прогноз @s </legend>

                <p>
                    <label class="boxdata-label-40 "> Дата составления прогноза </label>
                    @ecorehabilitation.date
                </p>
                <fieldset>
                    <legend>  @ecorehabilitation.incident.riskobject.name </legend>
                    <p>
                        <label class="boxdata-label-40 ">Область</label>
                        @ecorehabilitation.incident.riskobject.region.name;
                    </p>
                    <p>
                        <label class="boxdata-label-40 ">Район</label>
                        @ecorehabilitation.incident.riskobject.district.name;
                    </p>
                    
                    <p><label class="boxdata-label-40">Координаты. Широта</label>@ecorehabilitation.incident.riskobject.coordinates.lat.d.ToString()°&nbsp;@ecorehabilitation.incident.riskobject.coordinates.lat.m.ToString()'&nbsp;@ecorehabilitation.incident.riskobject.coordinates.lat.s.ToString("0.00")"</p>
                    <p><label class="boxdata-label-40">Координаты. Долгота</label>@ecorehabilitation.incident.riskobject.coordinates.lng.d.ToString()°&nbsp;@ecorehabilitation.incident.riskobject.coordinates.lng.m.ToString()'&nbsp;@ecorehabilitation.incident.riskobject.coordinates.lng.s.ToString("0.00")" </p>
                    <p><label class="boxdata-label-40">Координаты в градусах</label>@ecorehabilitation.incident.riskobject.coordinates.latitude.ToString()°&nbsp;@ecorehabilitation.incident.riskobject.coordinates.lngitude.ToString()°</p>

                    <p>
                        <label class="boxdata-label-40 ">Категория  земли</label>
                        @ecorehabilitation.incident.riskobject.cadastretype.name;
                    </p>
                    <p>
                        <label class="boxdata-label-40 ">Документ, определяющий ПДК</label>
                        @ecorehabilitation.incident.riskobject.cadastretype.ground_doc_name;
                    </p>

                </fieldset>

                <p>
                    <label class="boxdata-label-40 "> Нефтепродукт</label>
                    @ecorehabilitation.incident.petrochemicaltype.name
                </p>

                <p>
                    <label class="boxdata-label-40 "> Объем пролива (м<sup>3</sup>)</label>
                    @ecorehabilitation.incident.volume
                </p>

                <p>
                    <label class="boxdata-label-40 ">  Радиус разлива (м) </label>
                    @ecorehabilitation.groundblur.radius
                </p>

                <p>
                    <label class="boxdata-label-40 ">  Радиус распрстранения  нефтепродукта с грунтовыми водами (м)  </label>
                    @ecorehabilitation.waterblur.radius
                </p>

            </fieldset>
            <fieldset>
                <legend> Сравнение с предельно-допустимыми концентрациями </legend>

                <fieldset>
                    <legend> Наземное пятно загрязнения </legend>
                    <p>
                        <label class="boxdata-label-40 "> Средняя концентрация нефтепродукта  в грунтах зоны аэрации </label>
                        @ecorehabilitation.groundblur.concentrationinsoil
                    </p>
                    <p>
                        <label class="boxdata-label-40 "> Глубина проиникновения  загрязения (м)  </label>
                        @Math.Round(ecorehabilitation.groundblur.depth, 3)
                    </p>
                    <p>
                        <label class="boxdata-label-40 "> Предельно допустимая концентрация в грунте (кг/кг)  </label>
                        @ecorehabilitation.incident.riskobject.cadastretype.pdk_coef
                    </p>
                    @if (ecorehabilitation.excessgroundconcentration > 1)
                    {
                        <p>
                            <label class="boxdata-label-40 "> Кратность превышения   </label>
                            @Math.Round(ecorehabilitation.excessgroundconcentration, 1)
                        </p>
                    }
                    else
                    {
                        <p>
                            <label class="boxdata-label-40 "> Превышение   </label>
                            нет превышения
                        </p>
                    }
                    <p>
                        <label class="boxdata-label-40 "> Макс. концентрация на уровне (поверхности) грунтовых вод (кг/кг)</label>
                        @ecorehabilitation.groundblur.maxconcentrationwater
                    </p>
                    <p>
                        <label class="boxdata-label-40 "> Предельно допустимая концентрация в воде (кг/кг)  </label>
                        @ecorehabilitation.incident.riskobject.cadastretype.water_pdk_coef
                    </p>

                    @if (ecorehabilitation.exesswaterconcentration > 1)
                    {
                        <p>
                            <label class="boxdata-label-40 "> Кратность превышения   </label>
                            @Math.Round(ecorehabilitation.exesswaterconcentration, 1)
                        </p>
                    }
                    else
                    {
                        <p>
                            <label class="boxdata-label-40 "> Превышение   </label>
                            нет превышения
                        </p>
                    }
                    <fieldset>
                        <legend>Классификация уровня загрязнения </legend>
                        <p>
                            <label class="boxdata-label-40 ">Категория загрязнения грунта </label>
                            @ecorehabilitation.soilpollutioncategories.name
                        </p>
                        <p>
                            <label class="boxdata-label-40 ">Радиус поиска природоохранных объектов (м) </label>
                            @Math.Round(ecorehabilitation.groundblur.ecoobjectsearchradius, 0)

                        </p>
                        <p>
                            <label class="boxdata-label-40 ">Категория загрязнения грунтовых вод </label>
                            @ecorehabilitation.waterpollutioncategories.name
                        </p>
                    </fieldset>
                    <fieldset form="ChoiseRiskObject">
                                <legend> Природоохранные объекты </legend>
                                <p>
                                    <label class="boxdata-label-40 ">Радиус поиска прирооохранных объектов (м) </label>
                                    @Math.Round(ecorehabilitation.groundblur.ecoobjectsearchradius, 0)
                                </p>

                                @foreach (GroundPollution o in ecorehabilitation.groundpollutionlist)
                                {
                                    <fieldset form="ChoiseRiskObject">
                                        <legend>@o.comment @o.name </legend>
                                        <fieldset>
                                            <p><label class="boxdata-label-40">Координаты. Широта</label>@o.coordinates.lat.d.ToString()°&nbsp;@o.coordinates.lat.m.ToString()'&nbsp;@o.coordinates.lat.s.ToString("0.00")"</p>
                                            <p><label class="boxdata-label-40">Координаты. Долгота</label>@o.coordinates.lng.d.ToString()°&nbsp;@o.coordinates.lng.m.ToString()'&nbsp;@o.coordinates.lng.s.ToString("0.00")" </p>
                                            <p><label class="boxdata-label-40">Координаты в градусах</label>@o.coordinates.latitude.ToString()°&nbsp;@o.coordinates.lngitude.ToString()°</p>

                                            <p><label class="boxdata-label-40">Расстояние</label><span class="boxdata-span">@Math.Round(o.distance, 0)</span></p>
                                            <p><label class="boxdata-label-40">Высота (м)</label> @Math.Round(o.height, 0)</p>
                                            <p><label class="boxdata-label-40">Угол</label> @Math.Round(o.angle, 1)</p>
                                            <p><label class="boxdata-label-40">Глубина грунтовых вод (м)</label> @Math.Round(o.waterdeep, 1)</p>
                                        </fieldset>
                                    </fieldset>
                                }

                            </fieldset>

                </fieldset>
                <fieldset>
                    <legend> Распространение загрязнения с грунтовыми водами  </legend>
                    <p>
                        <label class="boxdata-label-40 ">  Радиус распрстранения  нефтепрдукта с грунтовыми водами (м)  </label>
                        @Math.Round(ecorehabilitation.waterblur.radius,0)
                    </p>
                    <fieldset>
                        <legend> Природоохранные объекты </legend>
                       <p>
                            <label class="boxdata-label-40 ">Радиус поиска природоохранных объектов (м)  </label>
                            @Math.Round(ecorehabilitation.groundblur.radius,0) -
                            @Math.Round(ecorehabilitation.waterblur.radius,0)
                       </p>
                        @foreach (WaterPollution o in ecorehabilitation.waterpolutionlist)
                        {
                            <fieldset>
                                <legend>@o.comment @o.name </legend>

                                <fieldset>
                                    <p><label class="boxdata-label-40">Координаты. Широта</label>@o.coordinates.lat.d.ToString()°&nbsp;@o.coordinates.lat.m.ToString()'&nbsp;@o.coordinates.lat.s.ToString("0.00")"</p>
                                    <p><label class="boxdata-label-40">Координаты. Долгота</label>@o.coordinates.lng.d.ToString()°&nbsp;@o.coordinates.lng.m.ToString()'&nbsp;@o.coordinates.lng.s.ToString("0.00")" </p>
                                    <p><label class="boxdata-label-40">Координаты в градусах</label>@o.coordinates.latitude.ToString()°&nbsp;@o.coordinates.lngitude.ToString()°</p>

                                    <p><label class="boxdata-label-40">Расстояние</label><span class="boxdata-span">@Math.Round(o.distance, 0)</span></p>
                                    <p><label class="boxdata-label-40">Высота (м)</label> @Math.Round(o.height, 0)</p>
                                    <p><label class="boxdata-label-40">Угол</label> @Math.Round(o.angle, 1)</p>
                                    <p><label class="boxdata-label-40">Глубина грунтовых вод (м)</label> @Math.Round(o.waterdeep, 1)</p>
                                </fieldset>
                                @if (o.iswaterobject)
                                {
                                    <p>
                                        <label class="boxdata-label-40 ">Водоохранный объект</label>&nbsp;
                                    </p>
                                }
                                <p>
                                    <label class="boxdata-label-40 ">Предельно допустимая концентрация (кг/кг) </label>
                                    @o.cadastretype.water_pdk_coef     @o.cadastretype.water_doc_name
                                </p>
                                <p>
                                    <label class="boxdata-label-40 ">Дата достижения максимальной концентрации  </label>
                                    @o.datemaxconcentration.ToShortDateString()  (@Math.Round(o.daymaxconcentration) сут.)
                                </p>
                                <p>
                                    <label class="boxdata-label-40 "> Кратность превышения   </label>
                                    @if (o.excessconcentration > 0)
                                    {
                                        @Math.Round(o.excessconcentration, 1);
                                    }
                                    else
                                    {<span>----</span> }

                                </p>
                                <p>
                                    @if (o.waterpollutioncategories != null)
                                    {
                                        <label class="boxdata-label-40 "> Категория загрязнения грунтовых вод </label>
                                        @o.waterpollutioncategories.name

                                    }
                                    else
                                    {<span>----</span> }
                                </p>
                            </fieldset>
                        }

                    </fieldset>
                </fieldset>
            </fieldset>
            @Html.Partial("_TypeLineMenu", head)
        </div>
        </div>

        }

        }
        else { <h2> Ошибка </h2>}

